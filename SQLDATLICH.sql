CREATE DATABASE DATLICH_HAIRS
GO
USE DATLICH_HAIRS
GO



CREATE TABLE USES
(
	USENAMES NVARCHAR(10) NOT NULL,
	PASSWORDS NVARCHAR(10) NOT NULL,
	ROLES NVARCHAR(5) NOT NULL,
	PRIMARY KEY (USENAMES),
	
	
)
GO

CREATE TABLE COSO
(
	MACS NVARCHAR(10) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	PRIMARY KEY (MACS)
)
GO

CREATE TABLE KHACHHANG
(
	USENAMES NVARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50) NOT NULL,
	NAMSINH DATE NOT NULL,
	SODT VARCHAR(10) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	GT NVARCHAR(5) NOT NULL,
	PRIMARY KEY (USENAMES),
	CONSTRAINT USES_KHACHHANG FOREIGN KEY (USENAMES) REFERENCES USES(USENAMES)
	
)
GO

CREATE TABLE STYLELIST
(
	USENAMES NVARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50) NOT NULL,
	SODT VARCHAR(10) NOT NULL,
	NAMSINH DATE NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	GT NVARCHAR(5) NOT NULL,
	MACS NVARCHAR(10) NOT NULL,
	PRIMARY KEY (USENAMES),
	CONSTRAINT STYLELIST_COSO FOREIGN KEY (MACS) REFERENCES COSO(MACS),
	
)
GO

CREATE TABLE GIOCAT
(
	USENAMES NVARCHAR(10) NOT NULL,
	USENAMESst NVARCHAR(10) NOT NULL,
	GIO NVARCHAR(10) NOT NULL,
	NGAY NVARCHAR(10) NOT NULL,
	PRIMARY KEY (USENAMES),
	FOREIGN KEY (USENAMES) REFERENCES KHACHHANG (USENAMES),
	CONSTRAINT STYLELIST_LICHCAT FOREIGN KEY (USENAMESst) REFERENCES STYLELIST(USENAMES)
)
GO




CREATE TABLE NHANVIEN
(
	USENAMES NVARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50) NOT NULL,
	SODT VARCHAR(10) NOT NULL,
	NAMSINH DATE NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	GT NVARCHAR(5) NOT NULL,
	PRIMARY KEY (USENAMES),
	CONSTRAINT USES_NHANVIEN FOREIGN KEY (USENAMES) REFERENCES USES(USENAMES),
)
GO



CREATE TABLE DICHVU
(
	MADV NVARCHAR(10) NOT NULL,
	TENDV NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL,
	THOIGIANDK INT NOT NULL,
	PRIMARY KEY (MADV)
)
GO

CREATE TABLE DATLICH
(
	ID INT IDENTITY(1,1) NOT NULL,
	USENAMES NVARCHAR(10) NOT NULL,
	TENDV NVARCHAR(50) NOT NULL,
	TENCOSO NVARCHAR(50) NOT NULL,
	USENAMEST NVARCHAR(10) NOT NULL,
	GIO NVARCHAR(10) NOT NULL,
	NGAY NVARCHAR(20) NOT NULL,
	TONGTIEN MONEY NOT NULL,
	STATUSS NVARCHAR(50) NOT NULL,
	PRIMARY KEY (ID),
	CONSTRAINT FK_DATLICH_KHACHHANG FOREIGN KEY (USENAMES) REFERENCES KHACHHANG(USENAMES),
	CONSTRAINT FK_DATLICH_STYLRLIST FOREIGN KEY (USENAMEST) REFERENCES STYLELIST(USENAMES)
)
GO




--THÊM USER
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('ThaoND','123','KH')   
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('TRANGTQ','123','KH')     
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('HungHV','123','NV') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('TuanAN','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('AnhQL','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('TienNA','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('LinhNK','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('KhangNV','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('VuNV','123','ST') 
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('AnhTT','123','ST')     
INSERT INTO USES (USENAMES, PASSWORDS, ROLES)
VALUES       ('QuyTV','123','ST')   

GO


--THÊM CƠ SỞ
INSERT INTO COSO
VALUES ('CS1', N'XÃ ĐÀN')
INSERT INTO COSO
VALUES ('CS2', N'LÁNG HẠ')
INSERT INTO COSO
VALUES ('CS3', N'CẦU GIẤY')

GO


--THÊM STYLE LIST
INSERT INTO STYLELIST
VALUES ('QuyTV', N'TRẦN VĂN QUÝ', '097456271','1996-09-04', N'HÀ NAM', 'NAM', 'CS1')
INSERT INTO STYLELIST
VALUES ('AnhQL', N'LÊ QUỐC ANH', '097456271','1996-09-04', N'HÀ NAM', 'NAM', 'CS1')
INSERT INTO STYLELIST
VALUES ('TienNA', N'NGUYỄN ANH TIẾN', '097456271','1997-07-02', N'PHÚ THỌ', 'NAM', 'CS2')
INSERT INTO STYLELIST
VALUES ('LinhNK', N'NGUYỄN KHÁNH LINH', '097456271','1992-12-02', N'SƠN LA', 'NAM', 'CS2')
INSERT INTO STYLELIST
VALUES ('KhangNV', N'NGUYỄN VĂN KHANG', '097456271','1999-07-02', N'HÀ NỘI', 'NAM', 'CS2')
INSERT INTO STYLELIST
VALUES ('VuNV', N'NGUYỄN VĂN VŨ', '097456271','1997-07-02', N'HÀ NỘI', 'NAM', 'CS3')
INSERT INTO STYLELIST
VALUES ('AnhTT', N'TRẦN TUẤN ANH', '097456271','1997-07-02', N'HÀ NỘI', 'NAM', 'CS3')

GO


--THÊM NHÂN VIÊN
INSERT INTO NHANVIEN
VALUES ('HungHV', N'HOÀNG VIỆT HÙNG', '097456271','1997-07-02', N'HÀ NỘI', 'NAM')

GO


--THÊM DỊCH VỤ
INSERT INTO DICHVU
VALUES ('DV1', N'CẮT + GỘI', 40000, 0.3)
INSERT INTO DICHVU
VALUES ('DV2', N'UỐN TÓC', 200000, 3)
INSERT INTO DICHVU
VALUES ('DV3', N'NHUỘM TÓC', 200000, 3)
INSERT INTO DICHVU
VALUES ('DV4', N'CẮT + UỐN', 240000, 3.5)
INSERT INTO DICHVU
VALUES ('DV5', N'CẮT + NHUỘM', 240000, 3.5)

 GO
 

 
----TRUY VẤN
--SELECT * FROM STYLELIST INNER JOIN COSO ON STYLELIST.MACS=COSO.MACS   
--INSERT INTO USES
--VALUES (?,?,'KH')   
--INSERT INTO KHACHHANG
--VALUES (?,?,?,?,?,?)      

--SELECT * FROM USES LEFT OUTER JOIN KHACHHANG ON USES.USENAMES=KHACHHANG.USENAMES
--SELECT HOTEN,NAMSINH,SODT,DIACHI,GT FROM KHACHHANG WHERE USENAMES=?
--SELECT HOTEN FROM STYLELIST WHERE MACS='CS3'

--SELECT USENAMES FROM STYLELIST WHERE HOTEN=?
--SELECT TENDV, THOIGIANDK, GIA, MADV FROM DICHVU
--SELECT USENAMES, HOTEN FROM STYLELIST WHERE HOTEN=N'LÊ QUỐC ANH'
--SELECT * FROM DATLICH INNER JOIN STYLELIST ON DATLICH.USENAMEST=STYLELIST.USENAMES
--SELECT * FROM STYLELIST INNER JOIN LICHCAT ON STYLELIST.USENAMES=LICHCAT.USENAMES
--	SELECT * FROM GIOCAT
--	SELECT * FROM LICHCAT
--DELETE FROM GIOCAT WHERE USENAMES LIKE 'VUONGLQ' 
--DELETE FROM LICHCAT WHERE USENAMES LIKE 'VUNV'
--select USENAMES,GIO,NGAY from LICHCAT

--SELECT  USENAMES,GIO,NGAY FROM  LICHCAT
-- WHERE USENAMES like 'tienna' and GIO like '07:00'and GIO like '08:00'or GIO like '09:00'or GIO like '10:00'
-- or GIO like '14:00'or GIO like '15:00'or GIO like '16:00'or GIO like '17:00'or GIO like '18:00'
 
 
-- SELECT * FROM LICHCAT where USENAMES='khangnv' and GIO='14:00' and NGAY='2020-01-01' 
-- select * from LICHCAT where NGAY = '01-01-2020'  
-- select * from DATLICH   
-- select * from KHACHHANG
 
--DECLARE @DATE NVARCHAR(20),
--		@GIO NVARCHAR(20),
--		@USENAMES NVARCHAR(20);
  
--SET @USENAMESst = ?;
--SET	@GIO = ?;
--SET	@DATE = ?;
  
--SELECT
--    USENAMES,
--    GIO,
--    NGAY
--FROM
--    GIOCAT
--WHERE
--    NGAY = @DATE AND
--	GIO = @GIO AND
--	USENAMES = @USENAMES


--SELECT KHACHHANG.HOTEN,KHACHHANG.SODT,TENDV,COSO.DIACHI,USENAMEST,GIO,NGAY,TONGTIEN,STATUSS FROM KHACHHANG INNER JOIN DATLICH ON
--KHACHHANG.USENAMES=DATLICH.USENAMES INNER JOIN STYLELIST ON
--DATLICH.USENAMEST=STYLELIST.USENAMES INNER JOIN COSO ON
--STYLELIST.MACS=COSO.MACS WHERE KHACHHANG.SODT='0968761205' AND USENAMEST=? AND COSO.DIACHI=N'XÃ ĐÀN' AND GIO='07:00' AND NGAY='28-11-2020'
    


--SELECT * FROM DATLICH INNER JOIN KHACHHANG ON
--DATLICH.USENAMES=KHACHHANG.USENAMES 

--UPDATE DATLICH SET STATUSS = N'Hoàn Thành' WHERE USENAMEST='AnhQL' AND GIO='08:00' AND NGAY='28-11-2020'
--DELETE FROM GIOCAT WHERE USENAMESst=? AND GIO=? AND NGAY=?

--SELECT KHACHHANG.HOTEN,TENDV,COSO.DIACHI,GIO,NGAY FROM KHACHHANG INNER JOIN DATLICH ON
--KHACHHANG.USENAMES=DATLICH.USENAMES INNER JOIN STYLELIST ON
--DATLICH.USENAMEST=STYLELIST.USENAMES INNER JOIN COSO ON
--STYLELIST.MACS=COSO.MACS WHERE USENAMEST=?	

--SELECT KHACHHANG.USENAMES, COSO.DIACHI,STYLELIST.HOTEN,TENDV,GIO,NGAY,TONGTIEN,STATUSS FROM KHACHHANG INNER JOIN DATLICH ON
--KHACHHANG.USENAMES=DATLICH.USENAMES INNER JOIN STYLELIST ON
--DATLICH.USENAMEST=STYLELIST.USENAMES INNER JOIN COSO ON
--STYLELIST.MACS=COSO.MACS WHERE USENAMES=? AND STATUSS=?
	                                        
--SELECT NGAY FROM KHACHHANG INNER JOIN DATLICH ON
--KHACHHANG.USENAMES=DATLICH.USENAMES INNER JOIN STYLELIST ON
--DATLICH.USENAMEST=STYLELIST.USENAMES INNER JOIN COSO ON
--STYLELIST.MACS=COSO.MACS WHERE KHACHHANG.USENAMES='thanh' AND STATUSS=N'Chưa Hoàn Thành' 
--SELECT * FROM KHACHHANG WHERE USENAMES=?

--SELECT * FROM USES WHERE USENAMES =? AND PASSWORDS=?
--UPDATE USES
-- SET PASSWORDS=?
-- WHERE USENAMES=?
-- SELECT USENAMES,STATUSS FROM DATLICH
-- SELECT * FROM STYLELIST

sp_rename 'KHACHHANG.GT', 'EMAIL','COLUMN';
ALTER TABLE GIOCAT
   ALTER COLUMN EMAIL VARCHAR(25) NOT NULL;

   ALTER TABLE GIOCAT
   ADD EMAIL VARCHAR(25) NOT NULL;


select HOTEN,TENDV,USENAMEST,GIOCAT.GIO,GIOCAT.NGAY from DATLICH inner join KHACHHANG on DATLICH.USENAMES=KHACHHANG.USENAMES
						INNER JOIN GIOCAT ON KHACHHANG.USENAMES=GIOCAT.USENAMES
SELECT * FROM KHACHHANG